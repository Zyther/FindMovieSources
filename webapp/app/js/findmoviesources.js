angular.module("fms",["ui.bootstrap","ui.router","fms.services","fms.controllers"]).config(function(a,f){f.otherwise("/s/");a.state("search",{url:"/s",views:{main:{templateUrl:"app/templates/search.html",controller:"cSearch"}}}).state("search.term",{url:"/:term",views:{results:{templateUrl:"app/templates/searchResults.html",controller:"cSearchResult"}}}).state("about",{url:"/about",views:{main:{templateUrl:"app/templates/about.html",controller:"cAbout"}}})});angular.module("fms.controllers",[]).controller("cSearchResult",function(a,f,d,e,c,g,b){function h(c){a.items=loadingItem;searchTerm=c;b.$emit("searchTrigger");e.Search(f,c,function(b){searchItems=b;a.items=b})}switch(g.term){case null:break;case "**new":break;case "":console.log("how did this happen");break;default:h(g.term)}a.openM=function(b){var a,c,f,e,g,h,l;searchItems.forEach(function(d){b===d.imdb&&(console.log("we have a match"),a=d.title,c=d.type,f=d.img,e=d.overview,g=d.year,h=d.imdb,l=
d.rating)});if("TV Show"===c)var n="tv";else"Movie"===c&&(n="mv");d.open({templateUrl:"searchModal.html",size:"lg",controller:"cModal",controllerAs:"$ctrl",resolve:{data:{title:a,type:c,type2:n,img:f,desc:e,imdb:h,year:g,sources:"<p>Loading Sources...</p>",rating:l}}})}}).controller("cSearch",function(a,f,d,e,c,g){"undefined"!==typeof g.term&&"undefined"===typeof a.theSearch&&"**new"!==g.term&&(a.theSearch=g.term);a.iSearch=function(b){b.preventDefault();if(typeof("undefined"!==a.theSearch))switch(b=
a.theSearch,b){case null:case "":console.log("nothing sent");break;case "**new":a.theSearch="";default:c.go("search.term",{term:b})}else a.items=errorSearch,c.go("search.term",{term:"errorSearching"})}}).controller("cModal",function(a,f,d,e,c,g){a.item=c;a.sourceHTML=d.trustAsHtml(c.sources);g.guide(e,c.type2,c.imdb,function(b){a.sourceHTML=d.trustAsHtml(b.data)});this.close=function(){f.dismiss("cancel")}}).controller("cAbout",function(a){}).controller("cNav",function(a,f,d,e,c){a.isNavCollapsed=
!0;c.$on("cSearchResult.searchTrigger",function(){console.log("trigger");a.navSearch=searchTerm});a.iSearch=function(c){c.preventDefault();var b=a.navSearch;typeof("undefined"!==b)?"**new"===b?(a.navSearch="",f.transitionTo("search",{term:"**new"})):e.Search(d,b,function(c){searchItems=c;a.items=c;f.transitionTo("search",{term:b})}):(a.items=errorSearch,f.transitionTo("search",{term:"errorSearching"}))}});angular.module("fms.services",[]).factory("Search",function(){return{someItem:function(){return someItem},Search:function(a,f,d){f=f.replace(/[^a-zA-Z0-9\,.' ]/g,"");a({method:"POST",url:"http://www.findmoviesources.com/gMI?query="+f}).then(function(a){var c=[];if(0!==a.data.total_results){var f=0;a.data.results.forEach(function(b){var a=(new Date).getTime(),d=b.original_language;if("tv"===b.media_type||"movie"===b.media_type){if("tv"===b.media_type){if(null!==b.first_air_date)var e=b.first_air_date,
e="First Episode: "+e;else e="N/A";var g="TV Show",k=b.name}else null!==b.release_date?(e=b.release_date,e="Release Date: "+e):e="N/A",g="Movie",k=b.title;var m=0<b.vote_count?b.vote_average+"/10 ("+b.vote_count+" reviews)":"0/10 (0 Reviews)";c.push(null===b.poster_path?{title:k,year:e,type:g,imdb:b.id,img:"assets/img/film.png",time:a,link:!0,lang:d,overview:b.overview,rating:m}:{title:k,year:e,type:g,imdb:b.id,img:"http://www.what.fyi/img.php?url=https://image.tmdb.org/t/p/w185"+b.poster_path,time:a,
link:!0,lang:d,overview:b.overview,rating:m});f++}});if(0<f)return searchItems=c,d(c)}return d(noResults)},function(a){console.dir(a);return d(errorSearch)})}}}).factory("getSources",function(){return{guide:function(a,f,d,e){a({method:"POST",url:"http://www.findmoviesources.com/gMT?tvmov="+f+"&id="+d}).then(function(a){return""==a.data.toString().replace(/(\s|\r|\n|\0|\t)/gmi,"")?e({data:"<b>No Sources Found </b>"}):e(a)},function(a){console.dir(a);return e("error getting results")})}}});var searchItems,searchTerm,someItem={item:{title:"Thanks for using Find Movie Sources.",img:"assets/img/film.png",year:"Above",overview:"Input must be two or more characters",rating:"Movie or TV Show",type:"Search for a",imdb:"N/A",link:!1}},loadingItem={item:{title:"Loading... This shouldn't take long.",img:"assets/img/film.png",year:"Loading...",overview:"Loading...",rating:"Loading...",type:"Loading",imdb:"N/A",link:!1}},noResults={item:{title:"No Results.",year:"No Results.",img:"assets/img/film.png",
overview:"Input must be two or more characters",imdb:"N/A",link:!1}},errorSearch={item:{title:"There was an error searching.",desc:"Error.",year:"Error",img:"assets/img/film.png",imdb:"N/A",link:!1}};
